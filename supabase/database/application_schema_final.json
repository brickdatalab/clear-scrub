{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Business Loan Application Document",
  "description": "Schema for a single document extracted from a multi-document submission",
  "type": "object",
  "required": [
    "submission_id",
    "document_id",
    "source",
    "file_name",
    "extraction"
  ],
  "properties": {
    "submission_id": {
      "type": "string",
      "description": "System-generated ID shared across all documents in the same submission"
    },
    "document_id": {
      "type": "string",
      "description": "System-generated unique ID for this specific document"
    },
    "source": {
      "type": "string",
      "enum": ["dashboard", "email", "api"],
      "description": "Origin of the uploaded document"
    },
    "file_name": {
      "type": "string",
      "description": "Original file name of the uploaded document"
    },
    "extraction": {
      "type": "object",
      "required": ["company", "application", "confidence_score"],
      "properties": {
        "company": {
          "type": "object",
          "required": [
            "legal_name",
            "ein",
            "address_line1",
            "city",
            "state",
            "zip"
          ],
          "properties": {
            "legal_name": {
              "type": "string",
              "minLength": 1
            },
            "dba_name": {
              "type": ["string", "null"]
            },
            "ein": {
              "type": "string",
              "pattern": "^[0-9]{2}-[0-9]{7}$",
              "description": "Employer Identification Number in format XX-XXXXXXX"
            },
            "industry": {
              "type": ["string", "null"]
            },
            "address_line1": {
              "type": "string",
              "minLength": 1
            },
            "address_line2": {
              "type": ["string", "null"]
            },
            "city": {
              "type": "string",
              "minLength": 1
            },
            "state": {
              "type": "string",
              "pattern": "^[A-Z]{2}$",
              "description": "Two-letter uppercase state code"
            },
            "zip": {
              "type": "string",
              "pattern": "^[0-9]{5}(-[0-9]{4})?$",
              "description": "5-digit or 9-digit ZIP code"
            },
            "phone": {
              "type": ["string", "null"]
            },
            "email": {
              "type": ["string", "null"]
            },
            "website": {
              "type": ["string", "null"]
            }
          },
          "additionalProperties": false
        },
        "application": {
          "type": "object",
          "required": ["owner_1_first_name", "owner_1_last_name"],
          "properties": {
            "business_structure": {
              "type": ["string", "null"],
              "enum": [
                "Sole Proprietorship",
                "Partnership",
                "LLC",
                "Corporation",
                "S-Corp",
                "C-Corp",
                "Non-Profit",
                "Other",
                null
              ]
            },
            "start_date": {
              "type": ["string", "null"],
              "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
            },
            "years_in_business": {
              "type": ["number", "null"]
            },
            "number_of_employees": {
              "type": ["integer", "null"]
            },
            "annual_revenue": {
              "type": ["number", "null"]
            },
            "amount_requested": {
              "type": ["number", "null"]
            },
            "loan_purpose": {
              "type": ["string", "null"]
            },
            "owner_1_first_name": {
              "type": "string",
              "minLength": 1
            },
            "owner_1_middle_name": {
              "type": ["string", "null"]
            },
            "owner_1_last_name": {
              "type": "string",
              "minLength": 1
            },
            "owner_1_ssn": {
              "type": ["string", "null"],
              "pattern": "^[0-9]{3}-[0-9]{2}-[0-9]{4}$"
            },
            "owner_1_dob": {
              "type": ["string", "null"],
              "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
            },
            "owner_1_ownership_pct": {
              "type": ["number", "null"],
              "minimum": 0,
              "maximum": 100
            },
            "owner_1_address": {
              "oneOf": [
                {
                  "type": "object",
                  "required": ["address_line1", "city", "state", "zip"],
                  "properties": {
                    "address_line1": { "type": "string", "minLength": 1 },
                    "address_line2": { "type": ["string", "null"] },
                    "city": { "type": "string", "minLength": 1 },
                    "state": { "type": "string", "pattern": "^[A-Z]{2}$" },
                    "zip": {
                      "type": "string",
                      "pattern": "^[0-9]{5}(-[0-9]{4})?$"
                    }
                  },
                  "additionalProperties": false
                },
                { "type": "null" }
              ]
            },
            "owner_1_cell_phone": {
              "type": ["string", "null"]
            },
            "owner_1_home_phone": {
              "type": ["string", "null"]
            },
            "owner_1_email": {
              "type": ["string", "null"]
            },
            "owner_2_first_name": {
              "type": ["string", "null"]
            },
            "owner_2_middle_name": {
              "type": ["string", "null"]
            },
            "owner_2_last_name": {
              "type": ["string", "null"]
            },
            "owner_2_ssn": {
              "type": ["string", "null"],
              "pattern": "^[0-9]{3}-[0-9]{2}-[0-9]{4}$"
            },
            "owner_2_dob": {
              "type": ["string", "null"],
              "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
            },
            "owner_2_ownership_pct": {
              "type": ["number", "null"],
              "minimum": 0,
              "maximum": 100
            },
            "owner_2_address": {
              "oneOf": [
                {
                  "type": "object",
                  "required": ["address_line1", "city", "state", "zip"],
                  "properties": {
                    "address_line1": { "type": "string", "minLength": 1 },
                    "address_line2": { "type": ["string", "null"] },
                    "city": { "type": "string", "minLength": 1 },
                    "state": { "type": "string", "pattern": "^[A-Z]{2}$" },
                    "zip": {
                      "type": "string",
                      "pattern": "^[0-9]{5}(-[0-9]{4})?$"
                    }
                  },
                  "additionalProperties": false
                },
                { "type": "null" }
              ]
            },
            "owner_2_cell_phone": {
              "type": ["string", "null"]
            },
            "owner_2_home_phone": {
              "type": ["string", "null"]
            },
            "owner_2_email": {
              "type": ["string", "null"]
            }
          },
          "additionalProperties": false
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}